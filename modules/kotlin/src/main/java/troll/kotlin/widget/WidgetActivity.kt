package troll.kotlin.widgetimport android.app.PendingIntentimport android.appwidget.AppWidgetManagerimport android.content.ComponentNameimport android.content.Contextimport android.content.Intentimport android.os.Buildimport android.os.Bundleimport android.view.LayoutInflaterimport com.blankj.utilcode.util.AppUtilsimport troll.btc.extensions.onClickimport troll.eth.base.viewbinding.BaseActivityimport troll.kotlin.databinding.ActivityWidgetBinding/** * author : TangPeng * date : 10/20/22 11:01 * description : */class WidgetActivity : BaseActivity<ActivityWidgetBinding>() {    private val ACTION_CREATE_APPWIDGET = "CreateAppWidget"    override fun getBinding(inflater: LayoutInflater): ActivityWidgetBinding =        ActivityWidgetBinding.inflate(inflater)    override fun flowData() {    }    override fun flowView() {        bd.widgetAdd.onClick {            addWidget(this, AdaptiveWidget::class.java)        }        bd.widgetZero.onClick {            refresh(0)        }        bd.widgetOne.onClick {            refresh(1)        }        bd.widgetTwo.onClick {            refresh(2)        }        bd.widgetThree.onClick {            refresh(3)        }        bd.widgetFour.onClick {            refresh(4)        }    }    fun addWidget(context: Context, clazz: Class<*>) {        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {            val instance = AppWidgetManager.getInstance(this)            val componentName = ComponentName(context, clazz)            val bundle = Bundle()            val pinnedWidgetCallbackIntent = Intent().apply {                action = ACTION_CREATE_APPWIDGET            }            val successCallback = PendingIntent.getBroadcast(                context, 0, pinnedWidgetCallbackIntent, PendingIntent.FLAG_UPDATE_CURRENT            )            instance.requestPinAppWidget(componentName, bundle, successCallback)        }    }    fun refresh(num: Int) {        val intent = Intent()        intent.action = "com.troll.widget.adapt"        intent.putExtra("num", num)        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {            intent.component =                ComponentName(AppUtils.getAppPackageName(), "troll.kotlin.widget.AdaptiveWidget")        }        this.sendBroadcast(intent)    }}