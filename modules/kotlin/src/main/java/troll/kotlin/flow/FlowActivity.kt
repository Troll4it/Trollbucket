package troll.kotlin.flowimport android.view.LayoutInflaterimport androidx.activity.viewModelsimport androidx.lifecycle.lifecycleScopeimport com.troll.bus.Busimport kotlinx.coroutines.*import kotlinx.coroutines.flow.*import troll.btc.extensions.onClickimport troll.eth.base.viewbinding.BaseActivityimport troll.kotlin.databinding.ActivityFlowBindingclass FlowActivity : BaseActivity<ActivityFlowBinding>() {    private val vm: FlowViewModel by viewModels()    // select 操作符    private val selectVm: SelectViewModel by viewModels()    override fun getBinding(inflater: LayoutInflater): ActivityFlowBinding =        ActivityFlowBinding.inflate(inflater)    override fun flowData() {        Bus.get().with(this).onValue<String>(1) {            println("数据接收$it")        }        lifecycleScope.launch {            selectVm.flowInfo.collect {                bd.busTv.text = it                println("lifecycleScope  $it   TextView的Text${bd.busTv.text}")            }        }        bd.busTv.text = buildString {            append("")        }    }    var time: Job? = null    override fun flowView() {        bd.busButtonSend.onClick {//            bus()//            monitorFlow()//            cancelFlow()//            distinctUntilChanged()//            countDown(20, lifecycleScope,//                onTick = {////                    vm.testStateFlow("测试StateFlow $it")//                    vm.testLive("测试LiveData $it")//                },//                onFinish = {////                })            // select 的使用            MainScope().launch {                time = countDown(20, this, onTick = {                    println("倒计时  $it")                }, onFinish = {                    println("倒计时完成")                })            }        }        bd.busButtonDismiss.onClick {            println("倒计时 点击取消")            time?.cancel()        }    }    fun countDown(        total: Int, scope: CoroutineScope,        onTick: ((Int) -> Unit)? = null,        onStart: (() -> Unit)? = null,        onFinish: (() -> Unit)? = null,    ): Job {        return flow {            for (i in total downTo 0) {                emit(i)                delay(1000)            }        }.flowOn(Dispatchers.Main)            .onStart { onStart?.invoke() }            .onCompletion { onFinish?.invoke() }            .onEach { onTick?.invoke(it) }            .launchIn(scope)    }    private fun bus() {        Bus.get().send(1, "测试发送")    }    private fun monitorFlow() {        vm.monitorFlow()    }    private fun cancelFlow() {        vm.cancelFlow()    }    private fun distinctUntilChanged() {        vm.distinctUntilChanged()    }}fun main() {//    println("0.02331".decimalFormatDigits2())}